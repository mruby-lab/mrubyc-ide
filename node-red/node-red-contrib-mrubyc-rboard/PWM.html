<script type="text/javascript">
	RED.nodes.registerType('PWM',{
		category: 'mruby_Rboad_Nodes',
		color: '#a6bbcf',
		defaults: {
			name: {value:""},
            targetPort_PWM: {value: "0"},
            PWM_num: {value: ""},
            cycle: {value: ""},
            double: {value: "0"},
            time: {value: ""},
            rate: {value: ""}
		},
		inputs:1,
		outputs:0,
		icon: "arrow-in.png",
		label: function() {
			return this.name||"PWM";
		},

        oneditprepare: function(){

            $("#node-input-PWM_num").on("change",function() {
                var Port = "";
                var PWM_num = this.value;

                if (PWM_num === "1"){
                    Port = "12";
                }else if(PWM_num === "2"){
                    Port = "16";
                }else if(PWM_num === "3"){
                    Port = "15";
                }else if(PWM_num === "4"){
                    Port = "18";
                }else if(PWM_num === "5"){
                    Port = "2";
                }
            /*
            $("#node-input-targetPort_PWM").val(Port);
            }).trigger("change");


            $("#node-input-time").on("change",function() {
                var time = this.value;
                var double = $("#node-input-double").val();
                var cycle;
                cycle = time*(2**double)*(10**-4)
                $("#node-input-cycle").val(cycle);
            }).trigger("change");

            $("#node-input-double").on("change",function() {
                var time = $("#node-input-time").val();
                var double = this.value;
                var cycle;
                cycle = time*(2**double)*(10**-4)
                $("#node-input-cycle").val(cycle);
            */
            }).trigger("change");
            
            

        }
	});


</script>

<script type="text/html" data-template-name="PWM">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> 名前</label>
        <input type="text" id="node-input-name" placeholder="名前">
    </div>


    <div class="form-row">
        <label for="node-input-PWM_num"><i class="icon-tag"></i> 出力Pin</label>
        <select id="node-input-PWM_num">
            <option value="1">PWM 1 (Pin12)</option>
            <option value="2">PWM 2 (Pin16)</option>
            <option value="3">PWM 3 ()</option>
            <option value="4">PWM 4 (Pin18)</option>
            <option value="5">PWM 5 (Pin2)</option>
        </select> 
    </div>

    <div class="form-row">
        <label for="node-input-cycle"><i class="icon-tag"></i>周波数設定[Hz]</label>
        <input type="text" id="node-input-cycle"  placeholder="1~">
    </div>
    
    <div class="form-tips"><b>注意:</b> 使用するPWMのチャンネルとPin番号は一致していません.以下のように設定されています.
        <br/>・PWM1 (Pin12)
        <br/>・PWM2 (Pin16)
        <br/>・PWM3 (Pin)
        <br/>・PWM4 (Pin18)
        <br/>・PWM5 (Pin2)
    </div>


</script>